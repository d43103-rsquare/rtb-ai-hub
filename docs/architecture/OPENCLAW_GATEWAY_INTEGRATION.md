# OpenClaw Gateway ì—°ë™ ê°€ì´ë“œ

## ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenClaw Gateway ì—°ë™                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Slack      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚      OpenClaw Gateway        â”‚    â”‚
â”‚  â”‚   (User)     â”‚  events  â”‚      (Port: 3000)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                            â”‚                    â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                          â”‚                 â”‚                 â”‚  â”‚
â”‚                    hooks â”‚                 â”‚ skills          â”‚  â”‚
â”‚                          â”‚                 â”‚ (exec curl)     â”‚  â”‚
â”‚                          â–¼                 â–¼                 â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚                   RTB AI Hub                            â”‚ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  webhook     â”‚  â”‚  Coordinatorâ”‚  â”‚  Workflow    â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  listener    â”‚  â”‚  API        â”‚  â”‚  Engine      â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  :4000       â”‚  â”‚  :4000      â”‚  â”‚              â”‚   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â”‚
â”‚  â”‚                                                         â”‚ â”‚  â”‚
â”‚  â”‚  1. Pattern ì™„ë£Œ â”€â”€â–¶ OpenClac hooks (Slack ì•Œë¦¼)      â”‚ â”‚  â”‚
â”‚  â”‚  2. Translation ì™„ë£Œ â”€â”€â–¶ OpenClaw hooks (DM ì „ì†¡)     â”‚ â”‚  â”‚
â”‚  â”‚  3. Wiki ì œì•ˆ â”€â”€â–¶ OpenClaw hooks (Thread ë‹µì¥)        â”‚ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1. Gateway ì„¤ì •

### 1.1 openclaw.json ì—…ë°ì´íŠ¸

```json
{
  "gateway": {
    "mode": "http",
    "port": 3000,
    "host": "0.0.0.0",
    "auth": {
      "mode": "token"
    }
  },
  "hooks": {
    "enabled": true,
    "path": "/hooks",
    "token": "${OPENCLAW_HOOKS_TOKEN}",
    "handlers": {
      "rtb-pattern-completed": {
        "channel": "slack",
        "template": "pattern-completed"
      },
      "rtb-translation-ready": {
        "channel": "slack",
        "template": "translation-ready"
      },
      "rtb-wiki-suggested": {
        "channel": "slack",
        "template": "wiki-suggested"
      }
    }
  },
  "channels": {
    "slack": {
      "enabled": true,
      "token": "${SLACK_BOT_TOKEN}",
      "dm": {
        "enabled": true,
        "policy": "pairing"
      }
    }
  },
  "skills": {
    "entries": {
      "rtb-hub": {
        "enabled": true,
        "env": {
          "RTB_WEBHOOK_URL": "http://webhook-listener:4000",
          "OPENCLAW_GATEWAY_URL": "http://openclaw-gateway:3000"
        }
      }
    }
  }
}
```

### 1.2 í™˜ê²½ ë³€ìˆ˜

```bash
# .env
OPENCLAW_HOOKS_TOKEN=rtb-ai-hub-openclaw-hooks-token-2026
SLACK_BOT_TOKEN=xoxb-your-slack-bot-token
OPENCLAW_GATEWAY_URL=http://localhost:3000
```

## 2. RTB Hub â†’ OpenClaw Gateway ì—°ë™

### 2.1 Gateway Client êµ¬í˜„

```typescript
// packages/workflow-engine/src/utils/openclaw-gateway.ts

import { createLogger } from '@rtb-ai-hub/shared';

const logger = createLogger('openclaw-gateway');

export interface OpenClawGatewayConfig {
  baseUrl: string;
  hooksToken: string;
}

export interface GatewayHookPayload {
  event: string;
  channel: string;
  target?: {
    userId?: string;
    channelId?: string;
    threadTs?: string;
  };
  data: Record<string, unknown>;
}

export class OpenClawGatewayClient {
  private config: OpenClawGatewayConfig;

  constructor(config: OpenClawGatewayConfig) {
    this.config = config;
  }

  /**
   * Gateway hooksë¡œ ì´ë²¤íŠ¸ ì „ì†¡
   */
  async sendHook(payload: GatewayHookPayload): Promise<void> {
    const url = `${this.config.baseUrl}/hooks`;

    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${this.config.hooksToken}`,
        },
        body: JSON.stringify(payload),
      });

      if (!response.ok) {
        throw new Error(`Gateway hook failed: ${response.status}`);
      }

      logger.info({ event: payload.event }, 'Gateway hook sent successfully');
    } catch (error) {
      logger.error({ error, event: payload.event }, 'Failed to send gateway hook');
      throw error;
    }
  }

  /**
   * íŒ¨í„´ ì™„ë£Œ ì•Œë¦¼
   */
  async notifyPatternCompleted(
    patternInstance: PatternInstance,
    targetUserId: string
  ): Promise<void> {
    await this.sendHook({
      event: 'rtb-pattern-completed',
      channel: 'slack',
      target: { userId: targetUserId },
      data: {
        patternId: patternInstance.patternId,
        patternName: this.getPatternName(patternInstance.patternId),
        status: patternInstance.status,
        outputs: patternInstance.outputs,
        participants: patternInstance.participants,
      },
    });
  }

  /**
   * ë²ˆì—­ ì™„ë£Œ ì•Œë¦¼
   */
  async notifyTranslationReady(
    translation: TranslationResult,
    targetUserId: string,
    options: { showOriginal?: boolean } = {}
  ): Promise<void> {
    await this.sendHook({
      event: 'rtb-translation-ready',
      channel: 'slack',
      target: { userId: targetUserId },
      data: {
        sourceRole: translation.sourceRole,
        targetRole: translation.targetRole,
        originalText: translation.input.raw,
        translatedText: translation.output.raw,
        quality: translation.quality,
        showOriginal: options.showOriginal ?? true,
      },
    });
  }

  /**
   * Wiki ì œì•ˆ ì•Œë¦¼
   */
  async notifyWikiSuggested(
    suggestion: WikiSuggestion,
    targetChannelId: string,
    threadTs?: string
  ): Promise<void> {
    await this.sendHook({
      event: 'rtb-wiki-suggested',
      channel: 'slack',
      target: {
        channelId: targetChannelId,
        threadTs,
      },
      data: {
        documentTitle: suggestion.document.title,
        summary: suggestion.document.summary,
        relevanceScore: suggestion.document.relevanceScore,
        urgency: suggestion.presentation.urgency,
        keySections: suggestion.document.keySections,
        reasoning: suggestion.reasoning,
      },
    });
  }

  /**
   * ì˜¨ë³´ë”© ì§„í–‰ ì•Œë¦¼
   */
  async notifyOnboardingProgress(
    plan: OnboardingPlan,
    stepCompleted: OnboardingStep
  ): Promise<void> {
    await this.sendHook({
      event: 'rtb-onboarding-progress',
      channel: 'slack',
      target: { userId: plan.userId },
      data: {
        planId: plan.id,
        stepName: stepCompleted.name,
        stepType: stepCompleted.type,
        overallProgress: plan.progress.overallProgress,
        nextStep: plan.phases.flatMap((p) => p.steps).find((s) => s.status === 'not-started')?.name,
      },
    });
  }

  private getPatternName(patternId: string): string {
    const names: Record<string, string> = {
      'requirement-clarification': 'ìš”êµ¬ì‚¬í•­ ëª…í™•í™”',
      'design-review': 'ë””ìì¸ ë¦¬ë·°',
      'implementation-sync': 'êµ¬í˜„ ë™ê¸°í™”',
      'testing-handoff': 'í…ŒìŠ¤íŠ¸ í•¸ë“œì˜¤í”„',
    };
    return names[patternId] || patternId;
  }
}

// ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
export const openclawGateway = new OpenClawGatewayClient({
  baseUrl: process.env.OPENCLAW_GATEWAY_URL || 'http://localhost:3000',
  hooksToken: process.env.OPENCLAW_HOOKS_TOKEN || '',
});
```

### 2.2 Pattern Engine í†µí•©

```typescript
// packages/workflow-engine/src/communication/patterns/pattern-engine.ts

import { openclawGateway } from '../../utils/openclaw-gateway';

export class PatternEngine {
  // ... ê¸°ì¡´ ì½”ë“œ

  /**
   * ë‹¨ê³„ ì™„ë£Œ ì‹œ Gateway ì•Œë¦¼
   */
  private async notifyPhaseCompletion(
    instance: PatternInstance,
    participant: PatternParticipant
  ): Promise<void> {
    if (!participant.userId) return;

    try {
      await openclawGateway.notifyPatternCompleted(instance, participant.userId);
    } catch (error) {
      logger.warn({ error }, 'Failed to send gateway notification');
      // Gateway ì‹¤íŒ¨í•´ë„ íŒ¨í„´ ì§„í–‰ì€ ê³„ì†
    }
  }

  /**
   * ìµœì¢… ì™„ë£Œ ì‹œ ëª¨ë“  ì°¸ì—¬ìì—ê²Œ ì•Œë¦¼
   */
  private async notifyCompletion(instance: PatternInstance): Promise<void> {
    for (const participant of instance.participants) {
      if (participant.userId) {
        await this.notifyPhaseCompletion(instance, participant);
      }
    }
  }
}
```

## 3. ì‚¬ìš© ì˜ˆì‹œ

### 3.1 Slackì—ì„œ íŒ¨í„´ ì‹œì‘

**ì‚¬ìš©ì:** "@openclaw PROJ-123 ìš”êµ¬ì‚¬í•­ ì •ë¦¬í•´ì¤˜"

**OpenClaw Skill ë™ì‘:**

```bash
# 1. íŒ¨í„´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
curl -X POST "${RTB_WEBHOOK_URL}/api/coordinator/patterns/instances" \
  -d '{
    "patternId": "requirement-clarification",
    "context": {
      "jiraKey": "PROJ-123",
      "slackChannelId": "C123456",
      "slackThreadTs": "1234567890.123456"
    }
  }'

# ì‘ë‹µ: { "id": "pattern_xxx", "status": "initiated" }
```

**RTB Hub í›„ì† ë™ì‘:**

```typescript
// íŒ¨í„´ ë‹¨ê³„ ì§„í–‰ ì‹œ Gatewayë¡œ ì•Œë¦¼
await openclawGateway.notifyPatternCompleted(patternInstance, 'pm@company.com');
```

**Slack ê²°ê³¼:**

```
ğŸ¯ ìš”êµ¬ì‚¬í•­ ëª…í™•í™” íŒ¨í„´ ì™„ë£Œ

ğŸ“‹ ê²°ê³¼ ìš”ì•½:
â€¢ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ: ì‚¬ìš©ì ë¡œê·¸ì¸ë¥  20% í–¥ìƒ
â€¢ ê¸°ìˆ  ëª…ì„¸: JWT ì¸ì¦, OAuth2 ì—°ë™
â€¢ ì‘ì—…ëŸ‰: 3 SP

ğŸ‘¥ ë‹¤ìŒ ë‹¨ê³„:
@developer ê°œë°œ ì‹œì‘ ì¤€ë¹„í•´ì£¼ì„¸ìš”!
```

### 3.2 ì‹¤ì‹œê°„ ë²ˆì—­

**ì‚¬ìš©ì (PM):** "@openclaw ê°œë°œìí•œí…Œ ì´ ë‚´ìš© ì „ë‹¬í•´ì¤˜: ë¡œê·¸ì¸ ê¸°ëŠ¥ MVP ë²”ìœ„ë¡œ ì´ë©”ì¼ë§Œ ì§€ì›"

**OpenClaw Skill:**

```bash
curl -X POST "${RTB_WEBHOOK_URL}/api/coordinator/translate" \
  -d '{
    "sourceRole": "pm",
    "targetRole": "backend-developer",
    "content": "ë¡œê·¸ì¸ ê¸°ëŠ¥ MVP ë²”ìœ„ë¡œ ì´ë©”ì¼ë§Œ ì§€ì›"
  }'
```

**RTB Hub â†’ Gateway:**

```typescript
await openclawGateway.notifyTranslationReady(translationResult, 'dev@company.com', {
  showOriginal: true,
});
```

**ê°œë°œì DM:**

```
ğŸ”„ PM ë©”ì‹œì§€ ë²ˆì—­

ğŸ’¬ ì›ë¬¸:
"ë¡œê·¸ì¸ ê¸°ëŠ¥ MVP ë²”ìœ„ë¡œ ì´ë©”ì¼ë§Œ ì§€ì›"

ğŸ“ ê°œë°œììš© ë²ˆì—­:
"ë¡œê·¸ì¸ MVP êµ¬í˜„:
â€¢ ì¸ì¦ ë°©ì‹: JWT (email/password only)
â€¢ ì†Œì…œ ë¡œê·¸ì¸: OUT OF SCOPE (í–¥í›„ ê³ ë ¤)
â€¢ API: POST /api/v1/auth/login
â€¢ ë°ì´í„°: users í…Œì´ë¸” (email, password_hash)
â€¢ ì˜ˆìƒ ì‘ì—…ëŸ‰: 2-3 SP"

ğŸ“Š ë²ˆì—­ í’ˆì§ˆ: 92%
```

## 4. ë¡œì»¬ ê°œë°œ ì„¤ì •

### 4.1 Docker Compose ì¶”ê°€

```yaml
# docker-compose.yml (ê¸°ì¡´ì— openclawê°€ ìˆë‹¤ë©´ ìˆ˜ì •)

services:
  openclaw-gateway:
    image: openclaw/gateway:latest
    ports:
      - '3000:3000'
    environment:
      - OPENCLAW_CONFIG=/config/openclaw.json
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - OPENCLAW_HOOKS_TOKEN=${OPENCLAW_HOOKS_TOKEN}
    volumes:
      - ./infrastructure/openclaw:/config:ro
      - ./infrastructure/openclaw/skills:/skills:ro
    networks:
      - rtb-network
    depends_on:
      - webhook-listener

  webhook-listener:
    # ê¸°ì¡´ ì„¤ì •
    environment:
      - OPENCLAW_GATEWAY_URL=http://openclaw-gateway:3000
      - OPENCLAW_HOOKS_TOKEN=${OPENCLAW_HOOKS_TOKEN}
```

### 4.2 í…ŒìŠ¤íŠ¸

```bash
# 1. Gateway hooks í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:3000/hooks \
  -H "Authorization: Bearer ${OPENCLAW_HOOKS_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "event": "rtb-test",
    "channel": "slack",
    "target": {"userId": "test@company.com"},
    "data": {"message": "Hello from RTB Hub!"}
  }'

# 2. RTB Hub API í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:4000/api/coordinator/translate \
  -H "Content-Type: application/json" \
  -d '{
    "sourceRole": "pm",
    "targetRole": "backend-developer",
    "content": "ë¡œê·¸ì¸ ê¸°ëŠ¥ ë§Œë“¤ì–´ì£¼ì„¸ìš”"
  }'
```

## 5. ëª¨ë‹ˆí„°ë§

### 5.1 Gateway ë¡œê·¸

```bash
# Gateway ë¡œê·¸ í™•ì¸
docker-compose logs -f openclaw-gateway

# Hooks ì „ì†¡ ì„±ê³µë¥  í™•ì¸
docker-compose exec openclaw-gateway \
  curl -s http://localhost:3000/metrics | grep rtb_hooks
```

### 5.2 ë©”íŠ¸ë¦­

```
# Prometheus ë©”íŠ¸ë¦­ (Gatewayê°€ ë…¸ì¶œ)
rtb_hooks_sent_total{event="rtb-pattern-completed"} 42
rtb_hooks_sent_total{event="rtb-translation-ready"} 128
rtb_hooks_failed_total 3
rtb_hook_latency_seconds 0.234
```

## ìš”ì•½

Gatewayë¥¼ í™œìš©í•˜ë©´:

1. **ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ **: RTB Hub â†’ OpenClaw â†’ Slack
2. **í…œí”Œë¦¿ ê¸°ë°˜ ë©”ì‹œì§€**: ì¼ê´€ëœ í˜•ì‹ì˜ ì•Œë¦¼
3. **DM/Channel ëª¨ë‘ ì§€ì›**: ê°œì¸ë³„ ì•Œë¦¼ + ì±„ë„ ê³µìœ 
4. **Threading ì§€ì›**: ëŒ€í™” ë§¥ë½ ìœ ì§€
5. **ì‹¤íŒ¨ ê²©ë¦¬**: Gateway ì‹¤íŒ¨í•´ë„ RTB Hub ë™ì‘ unaffected

ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? Gateway ì„¤ì •ë¶€í„° ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
