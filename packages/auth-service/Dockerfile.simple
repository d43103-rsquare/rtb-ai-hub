FROM node:20-alpine

WORKDIR /app

RUN npm config set strict-ssl false

COPY packages/shared ./packages/shared
WORKDIR /app/packages/shared
RUN npm install && npm run build && npm link

WORKDIR /app
COPY packages/auth-service ./packages/auth-service
WORKDIR /app/packages/auth-service

RUN npm link @rtb-ai-hub/shared && npm install --ignore-scripts && npm run build

EXPOSE 4001

ENV NODE_ENV=production

CMD ["node", "dist/index.js"]
