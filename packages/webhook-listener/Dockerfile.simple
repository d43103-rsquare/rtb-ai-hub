FROM node:20-alpine

WORKDIR /app

RUN npm config set strict-ssl false

COPY packages/shared ./packages/shared
COPY packages/webhook-listener ./packages/webhook-listener

WORKDIR /app/packages/shared
RUN npm install && npm run build && npm link

WORKDIR /app/packages/webhook-listener
RUN npm link @rtb-ai-hub/shared && npm install --ignore-scripts && npm run build

EXPOSE 4000

ENV NODE_ENV=production

CMD ["node", "dist/index.js"]
